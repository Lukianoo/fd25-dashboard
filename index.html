<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<title>Kotelna â€“ Attack FD 25</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,system-ui;}
body{background:linear-gradient(135deg,#1e3c72,#2a5298);color:#222}
header{display:flex;justify-content:space-between;align-items:center;background:#0d1a40;color:#fff;padding:15px 30px;box-shadow:0 4px 12px rgba(0,0,0,.4)}
#fsBtn{background:#ff9800;border:none;color:#fff;font-size:18px;padding:8px 14px;border-radius:8px;cursor:pointer}
main{max-width:1400px;margin:30px auto;padding:0 20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
.card{background:linear-gradient(145deg,#fff,#e6e6e6);border-radius:18px;padding:22px;box-shadow:0 12px 28px rgba(0,0,0,.3)}
h2{font-size:16px;color:#1e3c72;margin-bottom:10px}
.value{font-size:34px;font-weight:800}
.sub{font-size:13px;color:#555}
.blue{color:#1565c0}
.green{color:#2e7d32}
.orange{color:#ef6c00}
button{margin-top:12px;padding:12px;border-radius:12px;border:none;background:#1e3c72;color:#fff;font-size:15px;cursor:pointer}
#footerLogo{text-align:center;margin:40px 0 20px}
#footerLogo img{max-width:400px;width:50%}
</style>
</head>

<body>

<header>
  <div id="clock"></div>
  <div>Attack FD 25 â€“ PANEL KOTELNY</div>
  <button id="fsBtn">â›¶</button>
</header>

<main>

<div class="grid">
  <div class="card"><h2>ğŸ”¥ Kotel</h2><div class="value" id="tKotel">--</div></div>
  <div class="card"><h2>â†©ï¸ ZpÃ¡teÄka</h2><div class="value blue" id="tZpet">--</div></div>
  <div class="card"><h2>ğŸŒ¡ï¸ Î”T</h2><div class="value orange" id="deltaT">--</div></div>
  <div class="card"><h2>âš¡ VÃ½kon (1 h)</h2><div class="value green" id="powerKWbig">--</div></div>
  <div class="card"><h2>âš™ï¸ PodavaÄ</h2><div class="value" id="tPodavac">--</div></div>
  <div class="card"><h2>ğŸ’§ Bojler</h2><div class="value" id="tBojler">--</div></div>
  <div class="card"><h2>ğŸŒ¡ï¸ Venku</h2><div class="value" id="tVenku">--</div></div>
  <div class="card"><h2>â±ï¸ PodavaÄ celkem</h2><div class="value" id="feedTotal">--</div></div>
</div>

<br>

<div class="card">
  <h2>ğŸ“¦ CelkovÃ¡ spotÅ™eba od zaÄÃ¡tku</h2>
  <div class="sub">UhlÃ­</div>
  <div class="value blue" id="kgTotalAll">0 kg</div>
  <div class="sub">Cena</div>
  <div class="value green" id="costTotalAll">0 KÄ</div>
  <button id="resetTotalAllBtn">â™»ï¸ Vynulovat celkem</button>
</div>

<br>

<div class="card">
<h2>ğŸ’° SpotÅ™eba uhlÃ­</h2>
<div class="grid">
  <div><div class="sub">Hodina</div><div class="value orange" id="kgHour">0 kg</div></div>
  <div><div class="sub">Dnes</div><div class="value green" id="kgDay">0 kg</div></div>
  <div><div class="sub">MÄ›sÃ­c</div><div class="value blue" id="kgMonth">0 kg</div></div>
  <div><div class="sub">Cena dnes</div><div class="value" id="costDay">0 KÄ</div></div>
  <div><div class="sub">Cena mÄ›sÃ­c</div><div class="value" id="costMonth">0 KÄ</div></div>
</div>
</div>

<div id="footerLogo">
<img src="https://raw.githubusercontent.com/Lukianoo/fd25-dashboard/main/logo-elektroservis.png">
</div>

<script>
const CHANNEL=231269, ENERGY=4.8, EFF=0.75;
kg10min.value=localStorage.kg10min||2.5;
priceKg.value=localStorage.priceKg||6.2;
let totalAllOffset=Number(localStorage.totalAllOffset||0);

function secToKg(sec){return Math.max(0,(sec/600)*(+kg10min.value||2.5))}
function secToHMS(s){s=Math.floor(s);return`${String(Math.floor(s/3600)).padStart(2,"0")}:${String(Math.floor(s%3600/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`}
async function fetchFeeds(p){const r=await fetch(`https://api.thingspeak.com/channels/${CHANNEL}/feeds.json?${p}`);return(r.ok?(await r.json()).feeds:[])||[]}

async function updateTotalAll(){
  const f=await fetchFeeds("results=3000"); if(f.length<2)return;
  const sec=Math.max(0,(+f.at(-1).field8)-(+f[0].field8)-totalAllOffset);
  const kg=secToKg(sec);
  kgTotalAll.textContent=kg.toFixed(1)+" kg";
  costTotalAll.textContent=(kg*(+priceKg.value||6.2)).toFixed(0)+" KÄ";
}

resetTotalAllBtn.onclick=async()=>{
  if(!confirm("Opravdu vynulovat?"))return;
  const f=await fetchFeeds("results=1"); if(!f.length)return;
  totalAllOffset=+f[0].field8||0;
  localStorage.totalAllOffset=totalAllOffset;
  updateTotalAll();
}

fsBtn.onclick=()=>document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();
setInterval(()=>clock.textContent=new Date().toLocaleString("cs-CZ"),1000);
updateTotalAll();
</script>

</body>
</html>
