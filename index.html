<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Attack FD25 â€“ PÅ™ehled teplot</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 20px;
}
h1 {
  font-size: 1.8rem;
  margin-bottom: 10px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
}
.card {
  background: #020617;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  text-align: center;
}
.value {
  font-size: 2.2rem;
  font-weight: bold;
}
.unit {
  font-size: 1rem;
  opacity: 0.7;
}
canvas {
  margin-top: 10px;
}
.small {
  font-size: 0.9rem;
  opacity: 0.7;
}
</style>
</head>

<body>

<h1>ğŸ”¥ Attack FD25 â€“ RodinnÃ½ dÅ¯m</h1>
<p>FD25 + bojler DraÅ¾ice 125 l (TUV)</p>

<div class="grid">
  <div class="card"><div>VÃ½stup z kotle</div><div class="value" id="f2">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div>Kotel</div><div class="value" id="f5">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div>ZpÃ¡teÄka</div><div class="value" id="f1">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div>TUV</div><div class="value" id="f3">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div>VenkovnÃ­</div><div class="value" id="f4">â€“</div><div class="unit">Â°C</div></div>

  <div class="card">
    <div>Î”T (vÃ½stup âˆ’ zpÃ¡teÄka)</div>
    <div class="value" id="dt">â€“</div>
    <div class="unit">Â°C</div>
  </div>

  <div class="card">
    <div>Energie na ohÅ™ev TUV</div>
    <div class="value" id="kwh">â€“</div>
    <div class="unit">kWh</div>
    <div class="small">do 60 Â°C</div>
  </div>

  <div class="card">
    <div>HnÄ›dÃ© uhlÃ­ BÃ­lina</div>
    <div class="value" id="coal">â€“</div>
    <div class="unit">kg</div>
    <div class="small">ÃºÄinnost 75 %</div>
  </div>
</div>

<div class="card" style="margin-top:30px;">
  <h2>ğŸ“ˆ Historie teplot (24 h)</h2>
  <canvas id="chart"></canvas>
</div>

<script>
const CHANNEL_ID = 231269;
const RESULTS = 96;

const BOJLER_L = 125;
const TARGET_TUV = 60;
const ETA = 0.75;
const COAL_KWH_KG = 5.0;

let chart;

async function loadData() {
  const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=${RESULTS}`;
  const res = await fetch(url);
  const data = await res.json();
  const feeds = data.feeds;
  const last = feeds[feeds.length - 1];

  for (let i = 1; i <= 5; i++) {
    const v = last[`field${i}`];
    document.getElementById(`f${i}`).textContent =
      v !== null ? Number(v).toFixed(1) : 'â€“';
  }

  // Î”T
  const vystup = Number(last.field2);
  const zpatecka = Number(last.field1);
  const dt = vystup - zpatecka;
  document.getElementById('dt').textContent =
    !isNaN(dt) ? dt.toFixed(1) : 'â€“';

  // Energie TUV
  const tuv = Number(last.field3);
  if (!isNaN(tuv)) {
    const deltaT = Math.max(0, TARGET_TUV - tuv);
    const kwh = (BOJLER_L * deltaT * 4.186) / 3600 / ETA;
    const coal = kwh / COAL_KWH_KG;

    document.getElementById('kwh').textContent = kwh.toFixed(2);
    document.getElementById('coal').textContent = coal.toFixed(2);
  }

  const labels = feeds.map(f =>
    new Date(f.created_at).toLocaleTimeString('cs-CZ', { hour:'2-digit', minute:'2-digit' })
  );

  const datasets = [
    { label: 'VÃ½stup', field: 'field2' },
    { label: 'ZpÃ¡teÄka', field: 'field1' },
    { label: 'TUV', field: 'field3' },
    { label: 'VenkovnÃ­', field: 'field4' }
  ].map(cfg => ({
    label: cfg.label,
    data: feeds.map(f => f[cfg.field]),
    borderWidth: 2,
    tension: 0.3
  }));

  if (chart) chart.destroy();

  chart = new Chart(document.getElementById('chart'), {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color: '#e5e7eb' } } },
      scales: {
        x: { ticks: { color: '#94a3b8' } },
        y: { ticks: { color: '#94a3b8' } }
      }
    }
  });
}

loadData();
setInterval(loadData, 60000);
</script>

</body>
</html>
