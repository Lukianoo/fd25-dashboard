<!doctype html>
<html lang="cs">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
<meta charset="utf-8">
<title>Kotelna ‚Äì Attack FD 25</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- ===== STYLE ===== -->
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,system-ui;}
body{
  background: linear-gradient(135deg,#1e3c72,#2a5298);
  color:#222;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#0d1a40;
  color:#fff;
  padding:15px 30px;
  box-shadow:0 4px 12px rgba(0,0,0,.4);
  border-bottom-left-radius:10px;
  border-bottom-right-radius:10px;
}
header div{font-weight:600;}
#fsBtn{
  background:#ff9800;
  border:none;
  color:#fff;
  font-size:18px;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  transition:0.2s;
}
#fsBtn:hover{background:#e68900;}

main{max-width:1400px;margin:30px auto;padding:0 20px;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
}

.card{
  background:linear-gradient(145deg,#fff,#e0e0e0);
  border-radius:16px;
  padding:20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
  transition: transform 0.2s, box-shadow 0.2s;
}
.card:hover{
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.35);
}

h2{
  margin-bottom:12px;
  font-size:16px;
  color:#1e3c72;
}

.value{
  font-size:32px;
  font-weight:700;
  color:#d32f2f;
}

.sub{font-size:13px;color:#555;margin-bottom:4px;}
.green{color:#2e7d32;}
.blue{color:#1565c0;}
.orange{color:#ef6c00;}

input{
  width:100%;
  padding:10px;
  font-size:15px;
  border-radius:8px;
  border:1px solid #ccc;
  transition:0.2s;
}
input:focus{
  border-color:#1e3c72;
  outline:none;
}

.settings{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;}
button{
  padding:12px 18px;
  font-size:15px;
  border-radius:10px;
  border:none;
  background:#1e3c72;
  color:#fff;
  cursor:pointer;
  transition:0.2s;
}
button:hover{background:#16305c;}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  padding:10px;
  text-align:center;
  border-bottom:1px solid #ccc;
}
th{
  background:#f0f0f0;
}

#footerLogo{
  text-align:center;
  margin:40px 0 20px 0;
}
#footerLogo img{
  max-width:200px;
  width:50%;
  height:auto;
}

:fullscreen .value{
  font-size:42px;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<header>
  <div id="clock"></div>
  <div>Attack FD 25 ‚Äì Profi panel</div>
  <button id="fsBtn" title="Fullscreen">‚õ∂</button>
</header>

<!-- ===== MAIN CONTENT ===== -->
<main>

<!-- --- KARTY --- -->
<div class="grid">
  <div class="card"><h2>üî• Kotel</h2><div class="value" id="tKotel">--</div></div>
  <div class="card"><h2>‚Ü©Ô∏è Zp√°teƒçka</h2><div class="value blue" id="tZpet">--</div></div>
  <div class="card"><h2>üå°Ô∏è ŒîT</h2><div class="value orange" id="deltaT">--</div></div>
  <div class="card"><h2>‚ö° Energie (1 h)</h2><div class="value green" id="powerKWbig">--</div></div>
  <div class="card"><h2>‚öôÔ∏è Podavaƒç</h2><div class="value" id="tPodavac">--</div></div>
  <div class="card"><h2>üíß Bojler</h2><div class="value" id="tBojler">--</div></div>
  <div class="card"><h2>üå°Ô∏è Venku</h2><div class="value" id="tVenku">--</div></div>
  <div class="card"><h2>‚è±Ô∏è Podavaƒç celkem</h2><div class="value" id="feedTotal">--</div></div>
</div>

<!-- --- SPOT≈òEBA --- -->
<br>
<div class="card">
<h2>üí∞ Spot≈ôeba uhl√≠</h2>
<div class="grid">
  <div><div class="sub">HODINA</div><div class="value orange" id="kgHour">0 kg</div></div>
  <div><div class="sub">DNES</div><div class="value green" id="kgDay">0 kg</div></div>
  <div><div class="sub">MƒöS√çC</div><div class="value blue" id="kgMonth">0 kg</div></div>
  <div><div class="sub">CENA DNES</div><div class="value" id="costDay">0 Kƒç</div></div>
  <div><div class="sub">CENA MƒöS√çC</div><div class="value" id="costMonth">0 Kƒç</div></div>
</div>
<br>
<button id="historyBtn">üìÖ Denn√≠ historie spot≈ôeby</button>
<button id="monthHistoryBtn">üìÜ Mƒõs√≠ƒçn√≠ historie spot≈ôeby</button>
</div>

<!-- DENN√ç HISTORIE -->
historyBtn.onclick = async () => {
  historyBox.style.display = historyBox.style.display === "none" ? "block" : "none";

  const labels = [];
  const dataKg = [];
  const price = +priceKg.value || 6.2;

  historyTable.innerHTML = "";

  for (let i = 13; i >= 0; i--) {
    const d1 = new Date();
    d1.setDate(d1.getDate() - i);
    d1.setHours(0, 0, 0, 0);
    const d2 = new Date(d1);
    d2.setDate(d2.getDate() + 1);

    const feeds = await fetchFeeds(`start=${d1.toISOString()}&end=${d2.toISOString()}&results=2000`);

    if (feeds.length > 1) {
      const kg = secToKg(feeds.at(-1).field8 - feeds[0].field8);
      const cost = (kg * price).toFixed(0);

      // naplnƒõn√≠ tabulky
      historyTable.innerHTML += `
        <tr>
          <td>${d1.toLocaleDateString("cs-CZ",{day:"2-digit",month:"2-digit"})}</td>
          <td>${kg.toFixed(1)}</td>
          <td>${cost}</td>
        </tr>
      `;

      // pro graf
      labels.push(d1.toLocaleDateString("cs-CZ",{day:"2-digit",month:"2-digit"}));
      dataKg.push(kg.toFixed(1));
    }
  }

  // vykreslen√≠ grafu
  if (dayChartInstance) dayChartInstance.destroy();
  const ctx = document.getElementById('dayChart').getContext('2d');
  dayChartInstance = new Chart(ctx, {
    type: 'bar',
    data: { labels: labels, datasets: [{ label: 'Spot≈ôeba (kg)', data: dataKg, backgroundColor: '#1565c0' }] },
    options: { responsive: true, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: true } } }
  });
};

<!-- MƒöS√çƒåN√ç HISTORIE -->
monthHistoryBtn.onclick = async () => {
  monthHistoryBox.style.display = monthHistoryBox.style.display === "none" ? "block" : "none";

  const labels = [];
  const dataKg = [];
  const price = +priceKg.value || 6.2;

  monthHistoryTable.innerHTML = "";

  for (let i = 11; i >= 0; i--) {
    const s = new Date();
    s.setMonth(s.getMonth() - i, 1);
    s.setHours(0, 0, 0, 0);
    const e = new Date(s);
    e.setMonth(s.getMonth() + 1);

    const feeds = await fetchFeeds(`start=${s.toISOString()}&end=${e.toISOString()}&results=4000`);
    if (feeds.length > 1) {
      const kg = secToKg(feeds.at(-1).field8 - feeds[0].field8);
      const cost = (kg * price).toFixed(0);

      // naplnƒõn√≠ tabulky
      monthHistoryTable.innerHTML += `
        <tr>
          <td>${s.toLocaleDateString("cs-CZ",{month:"short",year:"2-digit"})}</td>
          <td>${kg.toFixed(0)}</td>
          <td>${cost}</td>
        </tr>
      `;

      // pro graf
      labels.push(s.toLocaleDateString("cs-CZ",{month:"short",year:"2-digit"}));
      dataKg.push(kg.toFixed(0));
    }
  }

  // vykreslen√≠ grafu
  if (monthChartInstance) monthChartInstance.destroy();
  const ctx = document.getElementById('monthChart').getContext('2d');
  monthChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Spot≈ôeba (kg)',
        data: dataKg,
        backgroundColor: 'rgba(46,125,50,0.2)',
        borderColor: '#2e7d32',
        fill: true,
        tension: 0.3,
        pointRadius: 5
      }]
    },
    options: { responsive: true, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: true } } }
  });
};


<!-- --- NASTAVEN√ç --- -->
<br>
<div class="card">
<h2>‚öôÔ∏è Nastaven√≠</h2>
<div class="settings">
  <div>
    <label>Kg uhl√≠ / 10 min</label>
    <input type="number" id="kg10min" step="0.1">
  </div>
  <div>
    <label>Cena / kg</label>
    <input type="number" id="priceKg" step="0.1">
  </div>
</div>
</div>
  

<!-- --- LOGO --- -->
<div id="footerLogo">
  <img src="https://raw.githubusercontent.com/Lukianoo/fd25-dashboard/main/logo-elektroservis.png" alt="Logo Elektroservis">
</div>

</main>

<!-- ===== SCRIPT ===== -->
<script>
const CHANNEL = 231269;
const ENERGY = 4.8; // kWh / kg
const EFF = 0.75;

kg10min.value = localStorage.kg10min || 2.5;
priceKg.value = localStorage.priceKg || 6.2;

function updateClock(){ clock.textContent = new Date().toLocaleString("cs-CZ"); }
function secToHMS(sec){ sec=Math.max(0,Math.floor(sec));const h=Math.floor(sec/3600);const m=Math.floor((sec%3600)/60);const s=sec%60; return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`; }
function secToKg(sec){ return Math.max(0,(sec/600)*(+kg10min.value||2.5)); }
function todayStartISO(){ const d=new Date();d.setHours(0,0,0,0);return d.toISOString(); }
function monthStartISO(){ const d=new Date();d.setDate(1);d.setHours(0,0,0,0);return d.toISOString(); }

async function fetchFeeds(p){ try{ const r=await fetch(`https://api.thingspeak.com/channels/${CHANNEL}/feeds.json?${p}`); return (await r.json()).feeds||[]; }catch(e){return[];} }

async function updateCurrent(){
  const cur=await fetchFeeds("results=1"); if(!cur.length)return; const f=cur[0];
  const tK=+f.field5||0; const tZ=+f.field1||0;
  tKotel.textContent=tK.toFixed(1)+" ¬∞C";
  tZpet.textContent=tZ.toFixed(1)+" ¬∞C";
  tPodavac.textContent=(+f.field2||0).toFixed(1)+" ¬∞C";
  tBojler.textContent=(+f.field3||0).toFixed(1)+" ¬∞C";
  tVenku.textContent=(+f.field4||0).toFixed(1)+" ¬∞C";
  deltaT.textContent=(tK-tZ).toFixed(1)+" ¬∞C";
  const totalSec=+f.field8||0; feedTotal.textContent=secToHMS(totalSec);
}

async function updateHour(){ const f=await fetchFeeds("minutes=60&results=120"); if(f.length<2)return; const kg=secToKg(f.at(-1).field8-f[0].field8); kgHour.textContent=kg.toFixed(2)+" kg"; powerKWbig.textContent=(kg*ENERGY*EFF).toFixed(1)+" kWh"; }
async function updateDay(){ const f=await fetchFeeds("start="+todayStartISO()+"&results=2000"); if(f.length<2)return; const kg=secToKg(f.at(-1).field8-f[0].field8); kgDay.textContent=kg.toFixed(2)+" kg"; costDay.textContent=(kg*(+priceKg.value||6.2)).toFixed(0)+" Kƒç"; }
async function updateMonth(){ const f=await fetchFeeds("start="+monthStartISO()+"&results=3000"); if(f.length<2)return; const kg=secToKg(f.at(-1).field8-f[0].field8); kgMonth.textContent=kg.toFixed(0)+" kg"; costMonth.textContent=(kg*(+priceKg.value||6.2)).toFixed(0)+" Kƒç"; }

historyBtn.onclick=async()=>{
  historyBox.style.display=historyBox.style.display==="none"?"block":"none";
  historyTable.innerHTML="";
  const price=+priceKg.value||6.2;
  for(let i=0;i<14;i++){
    const d1=new Date();d1.setDate(d1.getDate()-i);d1.setHours(0,0,0,0);
    const d2=new Date(d1);d2.setDate(d2.getDate()+1);
    const f=await fetchFeeds(`start=${d1.toISOString()}&end=${d2.toISOString()}&results=2000`);
    if(f.length>1){ const kg=secToKg(f.at(-1).field8-f[0].field8);
      historyTable.innerHTML+=`<tr><td>${d1.toLocaleDateString("cs-CZ")}</td><td>${kg.toFixed(2)}</td><td>${(kg*price).toFixed(0)}</td></tr>`; }
  }
};

monthHistoryBtn.onclick=async()=>{
  monthHistoryBox.style.display=monthHistoryBox.style.display==="none"?"block":"none";
  monthHistoryTable.innerHTML="";
  const price=+priceKg.value||6.2;
  for(let i=0;i<12;i++){
    const s=new Date();s.setMonth(s.getMonth()-i,1);s.setHours(0,0,0,0);
    const e=new Date(s);e.setMonth(e.getMonth()+1);
    const f=await fetchFeeds(`start=${s.toISOString()}&end=${e.toISOString()}&results=4000`);
    if(f.length>1){ const kg=secToKg(f.at(-1).field8-f[0].field8);
      monthHistoryTable.innerHTML+=`<tr><td>${s.toLocaleDateString("cs-CZ",{month:"long",year:"numeric"})}</td><td>${kg.toFixed(1)}</td><td>${(kg*price).toFixed(0)}</td></tr>`; }
  }
};

kg10min.oninput=()=>{ localStorage.kg10min=kg10min.value; updateHour(); updateDay(); updateMonth(); }
priceKg.oninput=()=>{ localStorage.priceKg=priceKg.value; updateDay(); updateMonth(); }

fsBtn.onclick=()=>{
  if(!document.fullscreenElement){ document.documentElement.requestFullscreen(); fsBtn.textContent="‚õ∂√ó"; }
  else{ document.exitFullscreen(); fsBtn.textContent="‚õ∂"; }
}

updateClock(); updateCurrent(); updateHour(); updateDay(); updateMonth();
setInterval(updateClock,1000);
setInterval(updateCurrent,30000);
setInterval(updateHour,300000);
setInterval(updateDay,900000);
setInterval(updateMonth,1800000);
let dayChartInstance = null;
let monthChartInstance = null;

// Denn√≠ graf
async function updateDayChart(){
  const labels = [];
  const dataKg = [];
  const price = +priceKg.value||6.2;
  for(let i=13;i>=0;i--){
    const d1 = new Date(); d1.setDate(d1.getDate()-i); d1.setHours(0,0,0,0);
    const d2 = new Date(d1); d2.setDate(d2.getDate()+1);
    const feeds = await fetchFeeds(`start=${d1.toISOString()}&end=${d2.toISOString()}&results=2000`);
    if(feeds.length>1){
      const kg = secToKg(feeds.at(-1).field8 - feeds[0].field8);
      labels.push(d1.toLocaleDateString("cs-CZ",{day:'2-digit',month:'2-digit'}));
      dataKg.push(kg.toFixed(1));
    }
  }

  if(dayChartInstance) dayChartInstance.destroy();
  const ctx = document.getElementById('dayChart').getContext('2d');
  dayChartInstance = new Chart(ctx,{
    type:'bar',
    data:{
      labels: labels,
      datasets:[
        {label:'Spot≈ôeba (kg)', data:dataKg, backgroundColor:'#1565c0'}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:true}},
      scales:{y:{beginAtZero:true}}
    }
  });
}

// Mƒõs√≠ƒçn√≠ graf
async function updateMonthChart(){
  const labels = [];
  const dataKg = [];
  const price = +priceKg.value||6.2;
  for(let i=11;i>=0;i--){
    const s = new Date(); s.setMonth(s.getMonth()-i,1); s.setHours(0,0,0,0);
    const e = new Date(s); e.setMonth(s.getMonth()+1);
    const feeds = await fetchFeeds(`start=${s.toISOString()}&end=${e.toISOString()}&results=4000`);
    if(feeds.length>1){
      const kg = secToKg(feeds.at(-1).field8 - feeds[0].field8);
      labels.push(s.toLocaleDateString("cs-CZ",{month:"short",year:"2-digit"}));
      dataKg.push(kg.toFixed(0));
    }
  }

  if(monthChartInstance) monthChartInstance.destroy();
  const ctx = document.getElementById('monthChart').getContext('2d');
  monthChartInstance = new Chart(ctx,{
    type:'line',
    data:{
      labels: labels,
      datasets:[
        {label:'Spot≈ôeba (kg)', data:dataKg, backgroundColor:'rgba(46,125,50,0.2)', borderColor:'#2e7d32', fill:true, tension:0.3, pointRadius:5}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:true}},
      scales:{y:{beginAtZero:true}}
    }
  });
}

// Zavol√°me po otev≈ôen√≠ box≈Ø
historyBtn.onclick = async()=>{
  historyBox.style.display = historyBox.style.display==="none"?"block":"none";
  await updateDayChart();
};

monthHistoryBtn.onclick = async()=>{
  monthHistoryBox.style.display = monthHistoryBox.style.display==="none"?"block":"none";
  await updateMonthChart();
};
  
</script>

</body>
</html>
