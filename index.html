<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Attack FD25 â€“ Profi panel vytÃ¡pÄ›nÃ­</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:20px;
}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}
.card {
  background:#020617;
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
}
.value { font-size:2rem; font-weight:bold; }
.unit { opacity:.7; }
.label { opacity:.8; font-size:.9rem; }
input {
  width:100%;
  padding:6px;
  background:#020617;
  color:#e5e7eb;
  border:1px solid #334155;
  border-radius:8px;
}
.section { margin-top:24px; }
</style>
</head>

<body>

<h1>ğŸ”¥ Attack FD25 â€“ Profi panel vytÃ¡pÄ›nÃ­</h1>
<small>PoslednÃ­ aktualizace: <span id="lastUpdate">â€“</span></small>

<!-- NASTAVENÃ ÄŒERPADLA -->
<div class="section grid">
  <div class="card">
    <div class="label">PrÅ¯tok topenÃ­ (l/h)</div>
    <input id="flowInput" type="number" value="800">
    <small>napÅ™. ALPHA2 â‰ˆ 600â€“1200 l/h</small>
  </div>
</div>

<!-- TEPLOTY -->
<div class="section grid">
  <div class="card"><div class="label">VÃ½stup</div><div class="value" id="f2">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div class="label">ZpÃ¡teÄka</div><div class="value" id="f1">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div class="label">Î”T</div><div class="value" id="dt">â€“</div><div class="unit">Â°C</div></div>
  <div class="card"><div class="label">TUV</div><div class="value" id="f3">â€“</div><div class="unit">Â°C</div></div>
</div>

<!-- ENERGIE -->
<div class="section grid">
  <div class="card"><div class="label">DennÃ­ energie â€“ topenÃ­</div><div class="value" id="dayHeat">â€“</div><div class="unit">kWh</div></div>
  <div class="card"><div class="label">MÄ›sÃ­ÄnÃ­ energie â€“ topenÃ­</div><div class="value" id="monthHeat">â€“</div><div class="unit">kWh</div></div>
  <div class="card"><div class="label">UhlÃ­ â€“ topenÃ­ (mÄ›sÃ­c)</div><div class="value" id="coalHeat">â€“</div><div class="unit">kg</div></div>
  <div class="card"><div class="label">Energie TUV â€“ tento mÄ›sÃ­c</div><div class="value" id="monthTUV">â€“</div><div class="unit">kWh</div></div>
</div>

<div class="section card">
  <h2>ğŸ“ˆ Teploty â€“ poslednÃ­ch 24 h</h2>
  <canvas id="chart"></canvas>
</div>

<script>
const CHANNEL_ID = 231269;
const BOILER_L = 125;
const COAL_PER_KWH = 0.27;

async function loadData() {
  const flow = parseFloat(document.getElementById('flowInput').value);
  const res = await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=800`);
  const data = await res.json();
  const feeds = data.feeds;

  let dayHeat = 0;
  let monthHeat = 0;
  let monthTUV = 0;

  const now = new Date();
  const month = now.getMonth();

  for (let i = 1; i < feeds.length; i++) {
    const a = feeds[i-1], b = feeds[i];
    const t1 = new Date(a.created_at);
    const t2 = new Date(b.created_at);
    const h = (t2 - t1) / 3600000;
    if (h <= 0 || h > 1) continue;

    const out = parseFloat(b.field2);
    const ret = parseFloat(b.field1);

    if (!isNaN(out) && !isNaN(ret)) {
      const dT = out - ret;
      const power = 1.163 * (flow/1000) * dT;
      const e = power * h;

      if (t2.toDateString() === now.toDateString()) dayHeat += e;
      if (t2.getMonth() === month) monthHeat += e;
    }

    const tuvA = parseFloat(a.field3);
    const tuvB = parseFloat(b.field3);
    if (!isNaN(tuvA) && !isNaN(tuvB)) {
      const dTt = tuvB - tuvA;
      if (dTt > 5 && t2.getMonth() === month) {
        monthTUV += BOILER_L * dTt * 0.001163;
      }
    }
  }

  const last = feeds.at(-1);
  document.getElementById('lastUpdate').textContent =
    new Date(last.created_at).toLocaleString('cs-CZ');

  document.getElementById('f1').textContent = last.field1;
  document.getElementById('f2').textContent = last.field2;
  document.getElementById('f3').textContent = last.field3;
  document.getElementById('dt').textContent =
    (last.field2 - last.field1).toFixed(1);

  document.getElementById('dayHeat').textContent = dayHeat.toFixed(1);
  document.getElementById('monthHeat').textContent = monthHeat.toFixed(0);
  document.getElementById('coalHeat').textContent =
    (monthHeat * COAL_PER_KWH).toFixed(0);
  document.getElementById('monthTUV').textContent = monthTUV.toFixed(1);

  drawChart(feeds.slice(-96));
}

function drawChart(feeds) {
  new Chart(document.getElementById('chart'), {
    type:'line',
    data:{
      labels:feeds.map(f=>new Date(f.created_at).toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit'})),
      datasets:[
        {label:'VÃ½stup', data:feeds.map(f=>f.field2)},
        {label:'ZpÃ¡teÄka', data:feeds.map(f=>f.field1)},
        {label:'TUV', data:feeds.map(f=>f.field3)}
      ]
    },
    options:{responsive:true}
  });
}

loadData();
document.getElementById('flowInput').addEventListener('change', loadData);
</script>

</body>
</html>
