<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<title>Kotelna â€“ Attack FD 25</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,system-ui;
  background:linear-gradient(135deg,#1e3c72,#2a5298);
  color:#222;
}
header{
  background:#000;
  color:#fff;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{max-width:1400px;margin:auto;padding:20px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
}

.card{
  background:#fff;
  border-radius:14px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}

h2{
  margin:0 0 12px;
  font-size:16px;
  color:#1e3c72;
}

.value{
  font-size:34px;
  font-weight:700;
  color:#d32f2f;
}
.sub{
  font-size:13px;
  color:#555;
}
.green{color:#2e7d32}
.blue{color:#1565c0}

.settings{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}

input{
  width:100%;
  padding:10px;
  font-size:15px;
}
</style>
</head>

<body>

<header>
  <div id="clock"></div>
  <div>Attack FD 25 â€“ Profi panel</div>
</header>

<main>

<!-- ====== TEPLOTY ====== -->
<div class="grid">
  <div class="card"><h2>ğŸ”¥ Kotel</h2><div class="value" id="tKotel">--</div></div>
  <div class="card"><h2>âš™ï¸ PodavaÄ</h2><div class="value" id="tPodavac">--</div></div>
  <div class="card"><h2>ğŸ’§ Bojler</h2><div class="value" id="tBojler">--</div></div>
  <div class="card"><h2>â†©ï¸ ZpÃ¡teÄka</h2><div class="value" id="tZpet">--</div></div>
  <div class="card"><h2>ğŸŒ¡ï¸ Venku</h2><div class="value" id="tVenku">--</div></div>
  <div class="card"><h2>â±ï¸ PodavaÄ â€“ Äas</h2><div class="value" id="feedTime">--</div></div>
</div>

<br>

<!-- ====== SPOTÅ˜EBA ====== -->
<div class="card">
<h2>ğŸ’° SpotÅ™eba uhlÃ­</h2>
<div class="grid">
  <div><div class="sub">AKTUÃLNÄš</div><div class="value green" id="consCurrent">0 kg</div></div>
  <div><div class="sub">DNES</div><div class="value green" id="consToday">0 kg</div></div>
  <div><div class="sub">MÄšSÃC</div><div class="value blue" id="consMonth">0 kg</div></div>
  <div><div class="sub">NÃKLADY DNES</div><div class="value" id="costToday">0 KÄ</div></div>
</div>
</div>

<br>

<!-- ====== VÃKON ====== -->
<div class="card">
<h2>âš¡ ReÃ¡lnÃ½ vÃ½kon z paliva</h2>
<div class="value" id="realPower">0 kW</div>
<div class="sub">VÃ½poÄet z kg/h (vÃ½hÅ™evnost 4.8 kWh/kg, ÃºÄinnost 75 %)</div>
</div>

<br>

<!-- ====== NASTAVENÃ ====== -->
<div class="card">
<h2>âš™ï¸ NastavenÃ­</h2>
<div class="settings">
  <div>
    <label>Kg uhlÃ­ za 10 min</label>
    <input type="number" id="kg10min" value="2.5" step="0.1">
  </div>
  <div>
    <label>Cena za kg</label>
    <input type="number" id="priceKg" value="15.5" step="0.1">
  </div>
</div>
</div>

</main>

<script>
/* ====== KONSTANTY ====== */
const CHANNEL = 231269;
const ENERGY_KWH_KG = 4.8;
const EFFICIENCY = 0.75;

/* ====== CLOCK ====== */
function updateClock(){
  clock.textContent = new Date().toLocaleString("cs-CZ");
}

/* ====== HELPERY ====== */
function secondsToKg(sec){
  return (sec / 600) * (parseFloat(kg10min.value) || 2.5);
}

function todayKey(){
  return new Date().toISOString().slice(0,10);
}

/* ====== RESET DNES ====== */
function checkDailyReset(currentSec){
  if(localStorage.day !== todayKey()){
    localStorage.day = todayKey();
    localStorage.baseSec = currentSec;
  }
  if(!localStorage.baseSec){
    localStorage.baseSec = currentSec;
  }
  return currentSec - localStorage.baseSec;
}

/* ====== FETCH ====== */
async function fetchFeeds(params){
  const r = await fetch(
    `https://api.thingspeak.com/channels/${CHANNEL}/feeds.json?${params}`
  );
  return (await r.json()).feeds || [];
}

/* ====== UPDATE ====== */
async function update(){
  const cur = await fetchFeeds("results=1");
  if(!cur.length) return;

  const f = cur[0];

  // teploty
  tKotel.textContent   = (+f.field5 || 0).toFixed(1)+" Â°C";
  tPodavac.textContent = (+f.field2 || 0).toFixed(1)+" Â°C";
  tBojler.textContent  = (+f.field3 || 0).toFixed(1)+" Â°C";
  tZpet.textContent    = (+f.field1 || 0).toFixed(1)+" Â°C";
  tVenku.textContent   = (+f.field4 || 0).toFixed(1)+" Â°C";

  const totalSec = +f.field8 || 0;
  feedTime.textContent = totalSec+" s";

  // aktuÃ¡lnÄ›
  consCurrent.textContent =
    secondsToKg(totalSec).toFixed(2)+" kg";

  // dnes
  const todaySec = checkDailyReset(totalSec);
  const todayKg = secondsToKg(todaySec);
  consToday.textContent = todayKg.toFixed(2)+" kg";
  costToday.textContent =
    (todayKg * (priceKg.value || 15.5)).toFixed(0)+" KÄ";

  // mÄ›sÃ­c
  const month = await fetchFeeds("days=30&results=8000");
  if(month.length > 1){
    const mSec = month.at(-1).field8 - month[0].field8;
    consMonth.textContent =
      secondsToKg(mSec).toFixed(0)+" kg";
  }

  // vÃ½kon z poslednÃ­ hodiny (odhad)
  const powerKgH = secondsToKg(todaySec) * (3600 / Math.max(todaySec,1));
  const powerKW = powerKgH * ENERGY_KWH_KG * EFFICIENCY;
  realPower.textContent = powerKW.toFixed(1)+" kW";
}

/* ====== START ====== */
updateClock();
update();
setInterval(updateClock,1000);
setInterval(update,30000);

kg10min.oninput = update;
priceKg.oninput = update;
</script>

</body>
</html>
