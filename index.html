<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Attack FD25 â€“ Profi panel vytÃ¡pÄ›nÃ­</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #020617;
  color: #e5e7eb;
  margin: 0;
  padding: 20px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

h1 {
  font-size: 2rem;
  margin: 0;
}

.update {
  font-size: 1rem;
  opacity: 0.8;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 18px;
}

.card {
  background: linear-gradient(180deg,#020617,#020617cc);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  text-align: center;
}

.card h3 {
  margin: 0 0 8px;
  font-size: 1rem;
  opacity: 0.85;
}

.value {
  font-size: 2.8rem;
  font-weight: bold;
}

.unit {
  font-size: 1rem;
  opacity: 0.6;
}

.section {
  margin-top: 30px;
}

canvas {
  margin-top: 10px;
}
</style>
</head>

<body>

<header>
  <h1>ğŸ”¥ Attack FD25 â€“ Profi panel vytÃ¡pÄ›nÃ­</h1>
  <div class="update" id="updated">Aktualizace: â€“</div>
</header>

<!-- TEPLOTY -->
<div class="grid">
  <div class="card">
    <h3>Kotel</h3>
    <div class="value" id="kotel">â€“</div>
    <div class="unit">Â°C</div>
  </div>

  <div class="card">
    <h3>VÃ½stup z kotle</h3>
    <div class="value" id="vystup">â€“</div>
    <div class="unit">Â°C</div>
  </div>

  <div class="card">
    <h3>ZpÃ¡teÄka</h3>
    <div class="value" id="zpat">â€“</div>
    <div class="unit">Â°C</div>
  </div>

  <div class="card">
    <h3>Î”T (vÃ½stup âˆ’ zpÃ¡teÄka)</h3>
    <div class="value" id="delta">â€“</div>
    <div class="unit">Â°C</div>
  </div>

  <div class="card">
    <h3>TUV</h3>
    <div class="value" id="tuv">â€“</div>
    <div class="unit">Â°C</div>
  </div>

  <div class="card">
    <h3>VenkovnÃ­ teplota</h3>
    <div class="value" id="venek">â€“</div>
    <div class="unit">Â°C</div>
  </div>
</div>

<!-- SPOTÅ˜EBA -->
<div class="section grid">
  <div class="card">
    <h3>DennÃ­ energie TUV</h3>
    <div class="value" id="day_kwh">â€“</div>
    <div class="unit">kWh</div>
  </div>

  <div class="card">
    <h3>DennÃ­ uhlÃ­ (ekv.)</h3>
    <div class="value" id="day_coal">â€“</div>
    <div class="unit">kg</div>
  </div>

  <div class="card">
    <h3>Energie TUV (24 h)</h3>
    <div class="value" id="month_kwh">â€“</div>
    <div class="unit">kWh</div>
  </div>

  <div class="card">
    <h3>UhlÃ­ (24 h)</h3>
    <div class="value" id="month_coal">â€“</div>
    <div class="unit">kg</div>
  </div>
</div>

<!-- GRAF -->
<div class="section card">
  <h3>ğŸ“ˆ Teploty â€“ poslednÃ­ch 24 hodin</h3>
  <canvas id="chart"></canvas>
</div>

<script>
const CHANNEL_ID = 231269;
const RESULTS = 96; // 24 h

const BOJLER = 125;
const CP = 4.186;
const ETA = 0.75;
const COAL_KWH = 5.0;

let chart;

function energyFromDelta(dT) {
  return BOJLER * CP * dT / 3600 / ETA;
}

async function loadData() {
  const res = await fetch(
    `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=${RESULTS}`
  );
  const data = await res.json();
  const feeds = data.feeds;
  const last = feeds[feeds.length - 1];

  document.getElementById("updated").textContent =
    "Aktualizace: " + new Date(last.created_at).toLocaleString("cs-CZ");

  const vystup = Number(last.field2);
  const zpat = Number(last.field1);

  document.getElementById("kotel").textContent = Number(last.field5).toFixed(1);
  document.getElementById("vystup").textContent = vystup.toFixed(1);
  document.getElementById("zpat").textContent = zpat.toFixed(1);
  document.getElementById("delta").textContent = (vystup - zpat).toFixed(1);
  document.getElementById("tuv").textContent = Number(last.field3).toFixed(1);
  document.getElementById("venek").textContent = Number(last.field4).toFixed(1);

  let energy = 0;
  for (let i = 1; i < feeds.length; i++) {
    const dT = feeds[i].field3 - feeds[i - 1].field3;
    if (dT > 0) energy += energyFromDelta(dT);
  }

  document.getElementById("day_kwh").textContent = energy.toFixed(1);
  document.getElementById("day_coal").textContent = (energy / COAL_KWH).toFixed(1);
  document.getElementById("month_kwh").textContent = energy.toFixed(1);
  document.getElementById("month_coal").textContent = (energy / COAL_KWH).toFixed(1);

  const labels = feeds.map(f =>
    new Date(f.created_at).toLocaleTimeString("cs-CZ", { hour: "2-digit", minute: "2-digit" })
  );

  const datasets = [
    { label: "VÃ½stup", field: "field2" },
    { label: "ZpÃ¡teÄka", field: "field1" },
    { label: "TUV", field: "field3" },
    { label: "VenkovnÃ­", field: "field4" }
  ].map(cfg => ({
    label: cfg.label,
    data: feeds.map(f => f[cfg.field]),
    borderWidth: 2,
    tension: 0.3
  }));

  if (chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"), {
    type: "line",
    data: { labels, datasets },
    options: {
      plugins: { legend: { labels: { color: "#e5e7eb" } } },
      scales: {
        x: { ticks: { color: "#94a3b8" } },
        y: { ticks: { color: "#94a3b8" } }
      }
    }
  });
}

loadData();
setInterval(loadData, 60000);
</script>

</body>
</html>
