<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<title>Attack FD 25 – Řídicí panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,system-ui;
  background:#0f172a;
  color:#e5e7eb;
}
header{
  background:#020617;
  padding:14px 24px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
  letter-spacing:.5px;
}
main{max-width:1600px;margin:auto;padding:24px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:18px;
}

.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
  padding:18px;
}

.card.big{grid-column:span 2}

h2{
  margin:0 0 8px;
  font-size:13px;
  color:#94a3b8;
  text-transform:uppercase;
  letter-spacing:.08em;
}

.value{
  font-size:34px;
  font-weight:700;
}

.fullscreen{
  grid-column:1/-1;
  text-align:center;
  padding:40px;
}

.fulltime{
  font-size:96px;
  font-weight:800;
  letter-spacing:4px;
  color:#f97316;
}

.sub{
  font-size:14px;
  color:#94a3b8;
}

.accent-red{color:#ef4444}
.accent-blue{color:#3b82f6}
.accent-orange{color:#f97316}
.accent-green{color:#22c55e}

input{
  width:100%;
  padding:10px;
  background:#020617;
  border:1px solid #1e293b;
  color:#e5e7eb;
  border-radius:8px;
}
</style>
</head>

<body>

<header>
  <div id="clock"></div>
  <div>ATTACK FD 25 · TECHNICKÝ PANEL</div>
</header>

<main>

<!-- FULLSCREEN ČAS PODAVAČE -->
<div class="card fullscreen">
  <h2>Podavač – celkový čas chodu</h2>
  <div class="fulltime" id="feederHHMMSS">--:--:--</div>
  <div class="sub">akumulovaný provoz</div>
</div>

<br>

<!-- TEPLOTY -->
<div class="grid">
  <div class="card"><h2>Kotel</h2><div class="value accent-red" id="tKotel">--</div></div>
  <div class="card"><h2>Podavač</h2><div class="value accent-red" id="tPodavac">--</div></div>
  <div class="card"><h2>Bojler</h2><div class="value" id="tBojler">--</div></div>
  <div class="card"><h2>Zpátečka</h2><div class="value" id="tZpet">--</div></div>
  <div class="card"><h2>Venkovní teplota</h2><div class="value" id="tVenku">--</div></div>
</div>

<br>

<!-- VÝKON + ΔT -->
<div class="grid">
  <div class="card big">
    <h2>Aktuální výkon (poslední hodina)</h2>
    <div class="value accent-orange" id="powerKW">-- kW</div>
  </div>

  <div class="card big">
    <h2>Teplotní spád ΔT</h2>
    <div class="value accent-blue" id="deltaT">-- °C</div>
    <div class="sub">Kotel – Zpátečka</div>
  </div>
</div>

</main>

<script>
const CHANNEL = 231269;
const ENERGY = 4.8;
const EFF = 0.75;

function updateClock(){
  clock.textContent=new Date().toLocaleString("cs-CZ");
}

function secToHHMMSS(sec){
  sec=Math.floor(sec);
  const h=Math.floor(sec/3600);
  const m=Math.floor((sec%3600)/60);
  const s=sec%60;
  return String(h).padStart(2,'0')+":"+
         String(m).padStart(2,'0')+":"+
         String(s).padStart(2,'0');
}

async function fetchFeeds(p){
  const r=await fetch(`https://api.thingspeak.com/channels/${CHANNEL}/feeds.json?${p}`);
  return (await r.json()).feeds||[];
}

async function update(){
  const cur=await fetchFeeds("results=1");
  if(!cur.length) return;
  const f=cur[0];

  tKotel.textContent=(+f.field5||0).toFixed(1)+" °C";
  tPodavac.textContent=(+f.field2||0).toFixed(1)+" °C";
  tBojler.textContent=(+f.field3||0).toFixed(1)+" °C";
  tZpet.textContent=(+f.field1||0).toFixed(1)+" °C";
  tVenku.textContent=(+f.field4||0).toFixed(1)+" °C";

  const totalSec=+f.field8||0;
  feederHHMMSS.textContent=secToHHMMSS(totalSec);

  deltaT.textContent=((+f.field5||0)-(+f.field1||0)).toFixed(1)+" °C";

  const hourFeeds=await fetchFeeds("minutes=60&results=200");
  if(hourFeeds.length>1){
    const hSec=hourFeeds.at(-1).field8-hourFeeds[0].field8;
    powerKW.textContent=((hSec/600)*2.5*ENERGY*EFF).toFixed(1)+" kW";
  }
}

updateClock();
update();
setInterval(updateClock,1000);
setInterval(update,30000);
</script>

</body>
</html>
