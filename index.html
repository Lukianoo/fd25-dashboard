<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Panel kotelny</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: #0f172a;
    color: #e5e7eb;
}

/* ===== HLAVIÄŒKA ===== */
header {
    background: #020617;
    padding: 15px 30px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    border-bottom: 2px solid #1e293b;
    flex-wrap: nowrap;
}

.header-left {
    font-size: 22px;
    font-weight: 600;
    white-space: nowrap;
}

.header-right {
    display: flex;
    gap: 25px;
    font-size: 22px;
    font-weight: 600;
    color: #94a3b8;
    white-space: nowrap;
}

/* ===== OBSAH ===== */
.container {
    padding: 25px;
}

.cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    gap: 20px;
}

.card {
    background: #020617;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
}

.card h2 {
    margin: 0;
    font-size: 15px;
    color: #94a3b8;
}

.value {
    font-size: 36px;
    margin-top: 10px;
}

.unit {
    font-size: 16px;
    color: #94a3b8;
}

canvas {
    background: #020617;
    border-radius: 12px;
    padding: 15px;
}

.footer {
    margin-top: 10px;
    font-size: 13px;
    color: #64748b;
    text-align: right;
}
</style>
</head>

<body>

<header>
    <div class="header-left">ðŸ”¥ Panel kotelny</div>

    <div class="header-right">
        <div id="now">â€“</div>
        <div>Aktualizace: <span id="lastUpdate">â€“</span></div>
    </div>
</header>

<div class="container">

<div class="cards">
    <div class="card">
        <h2>Teplota na kotli</h2>
        <div class="value"><span id="kotel">â€“</span><span class="unit"> Â°C</span></div>
    </div>

    <div class="card">
        <h2>Teplota bojler</h2>
        <div class="value"><span id="bojler">â€“</span><span class="unit"> Â°C</span></div>
    </div>

    <div class="card">
        <h2>Teplota venku</h2>
        <div class="value"><span id="venku">â€“</span><span class="unit"> Â°C</span></div>
    </div>

    <div class="card">
        <h2>SpotÅ™eba ohÅ™evu bojleru (24h)</h2>
        <div class="value"><span id="energie">â€“</span><span class="unit"> kWh</span></div>
    </div>
</div>

<br>

<canvas id="chart" height="120"></canvas>

<div class="footer">
    Data: ThingSpeak ID 1957585
</div>

</div>

<script>
const CHANNEL = 1957585;
const URL = `https://api.thingspeak.com/channels/${CHANNEL}/feeds.json?results=288`;

const BOJLER_OBJEM_L = 120; // litry
const C = 4.186; // kJ/kgÂ·K

/* ===== DATUM A ÄŒAS ===== */
function updateTime() {
    document.getElementById("now").innerText =
        new Date().toLocaleString("cs-CZ");
}
setInterval(updateTime, 1000);
updateTime();

/* ===== DATA Z THINGSPEAK ===== */
fetch(URL)
.then(r => r.json())
.then(data => {
    const feeds = data.feeds;
    const last = feeds[feeds.length - 1];

    document.getElementById("kotel").innerText = Number(last.field1).toFixed(1);
    document.getElementById("bojler").innerText = Number(last.field2).toFixed(1);
    document.getElementById("venku").innerText = Number(last.field3).toFixed(1);

    document.getElementById("lastUpdate").innerText =
        new Date(last.created_at).toLocaleString("cs-CZ");

    /* 24h DATA */
    const labels = feeds.map(f =>
        new Date(f.created_at).toLocaleTimeString("cs-CZ")
    );

    const kotel = feeds.map(f => Number(f.field1));
    const bojler = feeds.map(f => Number(f.field2));
    const venku = feeds.map(f => Number(f.field3));

    /* ENERGIE BOJLER */
    const dT = Math.max(bojler[bojler.length - 1] - bojler[0], 0);
    const energie = (BOJLER_OBJEM_L * C * dT) / 3600;
    document.getElementById("energie").innerText = energie.toFixed(2);

    /* GRAF */
    new Chart(document.getElementById("chart"), {
        type: "line",
        data: {
            labels,
            datasets: [
                { label: "Kotel", data: kotel, borderColor: "#f97316", tension: 0.3 },
                { label: "Bojler", data: bojler, borderColor: "#38bdf8", tension: 0.3 },
                { label: "Venku", data: venku, borderColor: "#22c55e", tension: 0.3 }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { labels: { color: "#e5e7eb" } }
            },
            scales: {
                x: { ticks: { color: "#94a3b8" } },
                y: { ticks: { color: "#94a3b8" } }
            }
        }
    });
});
</script>

</body>
</html>
