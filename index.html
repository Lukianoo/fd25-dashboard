<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Panel kotelny</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== T√âMATA ===== */
:root {
    --bg: #0f172a;
    --panel: #020617;
    --text: #e5e7eb;
    --muted: #94a3b8;
    --border: #1e293b;
}

.light {
    --bg: #f1f5f9;
    --panel: #ffffff;
    --text: #020617;
    --muted: #475569;
    --border: #cbd5f5;
}

/* ===== Z√ÅKLAD ===== */
body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: background .3s, color .3s;
}

/* ===== HLAVIƒåKA ===== */
header {
    background: var(--panel);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    border-bottom: 2px solid var(--border);
}

.header-left {
    font-size: 22px;
    font-weight: 600;
    white-space: nowrap;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 18px;
    font-size: 22px;
    font-weight: 600;
    color: var(--muted);
    white-space: nowrap;
}

.header-right button {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 8px;
    padding: 4px 8px;
    cursor: pointer;
}

/* ===== OBSAH ===== */
.container {
    padding: 20px;
}

.cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    gap: 20px;
}

.card {
    background: var(--panel);
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 0 20px rgba(0,0,0,0.35);
}

.card h2 {
    margin: 0;
    font-size: 15px;
    color: var(--muted);
}

.value {
    font-size: 36px;
    margin-top: 8px;
}

.unit {
    font-size: 16px;
    color: var(--muted);
}

canvas {
    background: var(--panel);
    border-radius: 12px;
    padding: 12px;
}

.footer {
    margin-top: 10px;
    font-size: 13px;
    color: var(--muted);
    text-align: right;
}

/* ===== MOBIL ===== */
@media (max-width: 600px) {
    .header-left,
    .header-right {
        font-size: 16px;
    }

    .cards {
        grid-template-columns: 1fr;
    }

    .value {
        font-size: 30px;
    }
}
</style>
</head>

<body>

<header>
    <div class="header-left">üî• Panel kotelny</div>

    <div class="header-right">
        <div id="now">‚Äì</div>
        <div>Aktualizace: <span id="lastUpdate">‚Äì</span></div>
        <button onclick="toggleTheme()">üåì</button>
        <button onclick="toggleFullscreen()">‚õ∂</button>
    </div>
</header>

<div class="container">

<div class="cards">
    <div class="card">
        <h2>Teplota na kotli</h2>
        <div class="value"><span id="kotel">‚Äì</span><span class="unit"> ¬∞C</span></div>
    </div>

    <div class="card">
        <h2>Teplota bojler</h2>
        <div class="value"><span id="bojler">‚Äì</span><span class="unit"> ¬∞C</span></div>
    </div>

    <div class="card">
        <h2>Teplota venku</h2>
        <div class="value"><span id="venku">‚Äì</span><span class="unit"> ¬∞C</span></div>
    </div>

    <div class="card">
        <h2>Energie pro oh≈ôev bojleru (24 h)</h2>
        <div class="value"><span id="energie">‚Äì</span><span class="unit"> kWh</span></div>
    </div>
</div>

<br>

<canvas id="chart" height="120"></canvas>

<div class="footer">
    Data: ThingSpeak ID 1957585
</div>

</div>

<script>
/* ===== NASTAVEN√ç ===== */
const CHANNEL = 1957585;
const URL = `https://api.thingspeak.com/channels/${CHANNEL}/feeds.json?results=288`;
const BOJLER_OBJEM_L = 120;
const C = 4.186;

/* ===== T√âMA ===== */
function toggleTheme() {
    document.body.classList.toggle("light");
    localStorage.setItem("theme",
        document.body.classList.contains("light") ? "light" : "dark");
}
if (localStorage.getItem("theme") === "light") {
    document.body.classList.add("light");
}

/* ===== FULLSCREEN ===== */
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
}

/* ===== ƒåAS (bez datumu) ===== */
function updateTime() {
    document.getElementById("now").innerText =
        new Date().toLocaleTimeString("cs-CZ");
}
setInterval(updateTime, 1000);
updateTime();

/* ===== DATA ===== */
fetch(URL)
.then(r => r.json())
.then(data => {
    const feeds = data.feeds;
    const last = feeds.at(-1);

    kotel.innerText = (+last.field1).toFixed(1);
    bojler.innerText = (+last.field2).toFixed(1);
    venku.innerText = (+last.field3).toFixed(1);

    lastUpdate.innerText =
        new Date(last.created_at).toLocaleTimeString("cs-CZ");

    const labels = feeds.map(f =>
        new Date(f.created_at).toLocaleTimeString("cs-CZ")
    );

    const bojlerData = feeds.map(f => +f.field2);

    const dT = Math.max(bojlerData.at(-1) - bojlerData[0], 0);
    const energie = (BOJLER_OBJEM_L * C * dT) / 3600;
    document.getElementById("energie").innerText = energie.toFixed(2);

    new Chart(chart, {
        type: "line",
        data: {
            labels,
            datasets: [
                { label: "Kotel", data: feeds.map(f=>+f.field1), borderColor: "#f97316", tension:.3 },
                { label: "Bojler", data: bojlerData, borderColor: "#38bdf8", tension:.3 },
                { label: "Venku", data: feeds.map(f=>+f.field3), borderColor: "#22c55e", tension:.3 }
            ]
        },
        options: {
            plugins: { legend: { labels: { color: getComputedStyle(document.body).color } } },
            scales: {
                x: { ticks: { color: getComputedStyle(document.body).color } },
                y: { ticks: { color: getComputedStyle(document.body).color } }
            }
        }
    });
});
</script>

</body>
</html>
