<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<title>Profi Panel Kotelny ‚Äì Attack FD 25</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
body{margin:0;font-family:Segoe UI;background:#1e3c72;color:#000}
header{background:#000;color:#fff;padding:15px 20px;display:flex;justify-content:space-between}
main{padding:20px;max-width:1400px;margin:auto}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}
.card{background:#fff;border-radius:15px;padding:20px}
.value{font-size:32px;font-weight:700;color:#d32f2f}
.sub{font-size:13px;color:#555}
.today{color:#4caf50}
.month{color:#2196f3}
input{width:100%;padding:10px}
</style>
</head>

<body>
<header>
  <div id="clock"></div>
  <div>üî• Re√°ln√Ω v√Ωkon + denn√≠ reset</div>
</header>

<main>

<div class="grid">
  <div class="card"><div class="sub">Teplota kotle</div><div class="value" id="field5">--</div></div>
  <div class="card"><div class="sub">ƒåas podavaƒçe</div><div class="value" id="field8">--</div></div>
</div>

<br>

<div class="card">
  <div class="sub">AKTU√ÅLNƒö</div>
  <div class="value today" id="consCurrent">0 kg</div>

  <div class="sub">DNES</div>
  <div class="value today" id="consToday">0 kg</div>

  <div class="sub">MƒöS√çC</div>
  <div class="value month" id="consMonth">0 kg</div>

  <div class="sub">V√ùKON (re√°ln√Ω)</div>
  <div class="value" id="realPower">0 kW</div>
</div>

<br>

<div class="card">
  <div class="sub">Kg / 10 min</div>
  <input type="number" id="feedRate10min" value="2.5" step="0.1">

  <div class="sub">Cena / kg</div>
  <input type="number" id="pricePerKg" value="15.5" step="0.1">
</div>

</main>

<script>
const CHANNEL_ID = 231269;
const COAL_ENERGY = 4.8;
const BOILER_EFF = 0.75;

const feedRateInput = document.getElementById("feedRate10min");

function clock(){
  clockEl.textContent = new Date().toLocaleString("cs-CZ");
}
const clockEl = document.getElementById("clock");

function secondsToKg(sec){
  return (sec/600)*(parseFloat(feedRateInput.value)||2.5);
}

function kgPerHour(seconds){
  return secondsToKg(seconds);
}

function powerFromKgH(kgH){
  return kgH * COAL_ENERGY * BOILER_EFF;
}

function todayKey(){
  return new Date().toISOString().slice(0,10);
}

function dailyBase(){
  const k = todayKey();
  if(localStorage.day !== k){
    localStorage.day = k;
    localStorage.base8 = null;
  }
}

async function fetchData(p){
  const r = await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?${p}`);
  return (await r.json()).feeds||[];
}

async function update(){
  dailyBase();

  const cur = await fetchData("results=1");
  if(!cur.length) return;

  const f = cur[0];
  const sec = parseFloat(f.field8)||0;

  if(localStorage.base8===null){
    localStorage.base8 = sec;
  }

  const todaySec = sec - parseFloat(localStorage.base8);

  field5.textContent = (parseFloat(f.field5)||0).toFixed(1)+" ¬∞C";
  field8.textContent = sec+" s";

  consCurrent.textContent = secondsToKg(sec).toFixed(2)+" kg";
  consToday.textContent = secondsToKg(todaySec).toFixed(2)+" kg";

  const monthFeeds = await fetchData("days=30&results=8000");
  if(monthFeeds.length>1){
    const m = monthFeeds.at(-1).field8 - monthFeeds[0].field8;
    consMonth.textContent = secondsToKg(m).toFixed(0)+" kg";
  }

  const power = powerFromKgH(kgPerHour(sec));
  realPower.textContent = power.toFixed(1)+" kW";
}

clock();
update();
setInterval(clock,1000);
setInterval(update,30000);
</script>
</body>
</html>
